<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</title>

<style>
*{box-sizing:border-box}
body{
 margin:0;
 font-family:Arial, sans-serif;
 background:#f4f6f8;
 direction:rtl;
}

/* ===== Ø§Ù„ØµÙØ­Ø§Øª ===== */
#pages{
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(140px,1fr));
 gap:15px;
 padding:20px;
}
.page{
 background:#fff;
 border-radius:16px;
 padding:25px 10px;
 text-align:center;
 font-size:16px;
 font-weight:bold;
 cursor:pointer;
 box-shadow:0 4px 10px rgba(0,0,0,.1);
 transition:.3s;
}
.page:hover{transform:scale(1.05)}

/* ===== Ø§Ù„Ù‡ÙŠØ¯Ø± ===== */
#header{
 display:none;
 justify-content:space-between;
 align-items:center;
 padding:15px;
 background:#fff;
 box-shadow:0 2px 8px rgba(0,0,0,.1);
}
#header button{
 padding:8px 14px;
 border:none;
 border-radius:10px;
 cursor:pointer;
}
#backBtn{background:#555;color:#fff}
#addBtn{background:#007bff;color:#fff}

/* ===== Ø§Ù„Ø¨Ø­Ø« ===== */
#searchBox{
 display:none;
 padding:10px;
 gap:10px;
}
#searchBox input,#searchBox select{
 padding:8px;
 border-radius:10px;
 border:1px solid #ccc;
}

/* ===== Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ===== */
#products{
 display:none;
 padding:15px;
 display:grid;
 grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
 gap:15px;
}
.card{
 background:#fff;
 border-radius:14px;
 padding:10px;
 text-align:center;
 position:relative;
 box-shadow:0 2px 6px rgba(0,0,0,.1);
}
.card img{
 width:90px;height:90px;
 border-radius:10px;
 object-fit:cover;
}
.card h4{margin:6px 0;font-size:15px}
.card span{color:#555;font-size:14px}

/* ===== Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ===== */
.menu{
 position:absolute;
 top:8px;
 left:8px;
 cursor:pointer;
}
.menu-content{
 display:none;
 position:absolute;
 top:20px;
 left:0;
 background:#fff;
 border-radius:8px;
 box-shadow:0 2px 6px rgba(0,0,0,.2);
 overflow:hidden;
}
.menu-content button{
 width:100%;
 border:none;
 background:none;
 padding:8px 12px;
 cursor:pointer;
 text-align:right;
}

/* ===== Popup ===== */
#popup{
 display:none;
 position:fixed;
 inset:0;
 background:rgba(0,0,0,.5);
 justify-content:center;
 align-items:center;
}
#popup form{
 background:#fff;
 padding:20px;
 border-radius:16px;
 width:90%;
 max-width:320px;
}
#popup input{
 width:100%;
 margin-bottom:10px;
 padding:8px;
 border-radius:10px;
 border:1px solid #ccc;
}
#popup button{
 width:100%;
 padding:10px;
 border:none;
 border-radius:12px;
 background:#28a745;
 color:#fff;
 font-size:16px;
}
</style>
</head>

<body>

<!-- Ø§Ù„ØµÙØ­Ø§Øª -->
<div id="pages"></div>

<!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
<div id="header">
 <button id="backBtn">â¬… Ø±Ø¬ÙˆØ¹</button>
 <button id="addBtn">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
</div>

<!-- Ø§Ù„Ø¨Ø­Ø« -->
<div id="searchBox">
 <select id="searchType">
  <option value="name">Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…</option>
  <option value="price">Ø¨Ø­Ø« Ø¨Ø§Ù„Ø³Ø¹Ø±</option>
 </select>
 <input id="searchInput" placeholder="Ø¨Ø­Ø«..." oninput="filterProducts()">
</div>

<!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
<div id="products"></div>

<!-- Popup -->
<div id="popup">
 <form onsubmit="saveProduct(event)">
  <input id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" required>
  <input id="pPrice" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" required>
  <input id="pImg" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
  <button>Ø­ÙØ¸</button>
 </form>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, deleteDoc, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* Firebase */
const app = initializeApp({
 apiKey: "AIzaSyDQ2ZkGiIKE5odbXsZD03on_OcIuUbkJmg",
 authDomain: "pharmacy-store-bc240.firebaseapp.com",
 projectId: "pharmacy-store-bc240"
});
const db = getFirestore(app);

/* ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ÙƒØ¨ÙŠØ± */
const pagesData = {
 "Index.html":"ğŸ ",
 "Childrens-supplies":"ğŸ‘¶",
 "Dental-care":"ğŸ¦·",
 "Deodorants-perfumes":"ğŸŒ¸",
 "Diapers":"ğŸ§·",
 "Dyes":"ğŸ¨",
 "Good-supplies":"ğŸ›ï¸",
 "Hair":"ğŸ’‡â€â™€ï¸",
 "Offer":"ğŸ·ï¸",
 "Sensitive-area-care":"ğŸ§´",
 "Shaving-supplies":"ğŸª’",
 "Skin":"ğŸ§´",
 "Sunscreen":"â˜€ï¸"
};

const pages=document.getElementById("pages");
const productsDiv=document.getElementById("products");
const popup=document.getElementById("popup");

let currentPage="", products=[], editId=null;

/* Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
for(let p in pagesData){
 pages.innerHTML+=`
 <div class="page" onclick="openPage('${p}')">
 ${pagesData[p]}<br>${p}
 </div>`;
}

/* ÙØªØ­ ØµÙØ­Ø© */
window.openPage=async(p)=>{
 currentPage=p;
 pages.style.display="none";
 header.style.display="flex";
 searchBox.style.display="flex";
 productsDiv.style.display="grid";
 loadProducts();
}

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
async function loadProducts(){
 products=[];
 const snap=await getDocs(collection(db,currentPage));
 snap.forEach(d=>products.push({id:d.id,...d.data()}));
 render();
}

/* Ø¹Ø±Ø¶ */
function render(){
 productsDiv.innerHTML="";
 products.forEach((p,i)=>{
  productsDiv.innerHTML+=`
  <div class="card">
   <div class="menu" onclick="this.children[0].style.display='block'">â‹®
    <div class="menu-content">
     <button onclick="editProduct(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
     <button onclick="deleteProduct('${p.id}')">Ø­Ø°Ù</button>
    </div>
   </div>
   <img src="${p.image||'https://via.placeholder.com/100'}">
   <h4>${p.name}</h4>
   <span>${p.price} Ø¬</span>
  </div>`;
 });
}

/* Ø¥Ø¶Ø§ÙØ© */
addBtn.onclick=()=>{
 editId=null;
 pName.value="";pPrice.value="";pImg.value="";
 popup.style.display="flex";
}

/* Ø­ÙØ¸ */
window.saveProduct=async(e)=>{
 e.preventDefault();
 if(editId){
  await updateDoc(doc(db,currentPage,editId),{
   name:pName.value,price:+pPrice.value,image:pImg.value
  });
 }else{
  await addDoc(collection(db,currentPage),{
   name:pName.value,price:+pPrice.value,image:pImg.value
  });
 }
 popup.style.display="none";
 loadProducts();
 alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
}

/* ØªØ¹Ø¯ÙŠÙ„ */
window.editProduct=(i)=>{
 const p=products[i];
 editId=p.id;
 pName.value=p.name;
 pPrice.value=p.price;
 pImg.value=p.image||"";
 popup.style.display="flex";
}

/* Ø­Ø°Ù */
window.deleteProduct=async(id)=>{
 if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")){
  await deleteDoc(doc(db,currentPage,id));
  loadProducts();
  alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ âœ…");
 }
}

/* Ø¨Ø­Ø« */
window.filterProducts=()=>{
 const v=searchInput.value.toLowerCase();
 const t=searchType.value;
 document.querySelectorAll(".card").forEach((c,i)=>{
  const ok=t==="name"
   ? products[i].name.toLowerCase().includes(v)
   : products[i].price.toString().includes(v);
  c.style.display=ok?"block":"none";
 });
}

/* Ø±Ø¬ÙˆØ¹ */
backBtn.onclick=()=>{
 pages.style.display="grid";
 header.style.display="none";
 searchBox.style.display="none";
 productsDiv.style.display="none";
};
</script>

</body>
</html>